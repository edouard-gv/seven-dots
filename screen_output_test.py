from screen_output import MockSerialPort, convert


def send_prefix(port):
    port.write(0x80)
    port.write(0x83)
    port.write(0x00)


def send_close(port):
    port.write(0x8F)


def send_bytes(port, *frame_bytes):
    for byte in frame_bytes:
        port.write(byte)


def test_noprint_digit():
    port = MockSerialPort()
    send_prefix(port)
    send_close(port)
    assert '\n' + port.output.replace(" ", ".") == \
           """
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           """


def test_oneprint_digit():
    port = MockSerialPort()
    send_prefix(port)
    send_bytes(port, 0b1111111)
    send_close(port)
    print(port.output.replace(" ", "."))

    assert port.output.replace(" ", ".") == \
           """\
           ._.........................
           |_|........................
           |_|........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           """


def test_two_print_digit():
    port = MockSerialPort()
    send_prefix(port)
    send_bytes(port, 0b1111111, 0x00, 0x00, 0x00, 0b1111111)
    send_close(port)
    print(port.output.replace(" ", "."))

    assert port.output.replace(" ", ".") == \
           """\
           ._..._.....................
           |_|.|_|....................
           |_|.|_|....................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           """


def test_three_print_digit():
    port = MockSerialPort()
    send_prefix(port)
    send_bytes(port, 0b1111111, 0b1111111, 0x00, 0x00)
    send_bytes(port, 0b1111111)
    send_close(port)
    print(port.output.replace(" ", "."))

    assert port.output.replace(" ", ".") == \
           """\
           ._..._.....................
           |_|.|_|....................
           |_|.|_|....................
           ...........................
           ._.........................
           |_|........................
           |_|........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           """


def test_full_line_print_digit():
    port = MockSerialPort()
    send_prefix(port)
    for _ in range(7):
        send_bytes(port, 0b1111111, 0x00, 0x00, 0x00)
    send_close(port)
    print(port.output.replace(" ", "."))

    assert port.output.replace(" ", ".") == \
           """\
           ._..._..._..._..._..._..._.
           |_|.|_|.|_|.|_|.|_|.|_|.|_|
           |_|.|_|.|_|.|_|.|_|.|_|.|_|
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           ...........................
           """


def test_convert_first_segment():
    assert convert(0b0000001) == [
        '   ',
        ' _ ',
        '   ']


def test_convert_first_and_second_segments():
    assert convert(0b0000011) == [
        '   ',
        '|_ ',
        '   ']


def test_for_fun():
    port = MockSerialPort()
    send_prefix(port)
    for i in range(28):
        send_bytes(port, i)
    send_close(port)
    print(port.output.replace(" ", " "))
    assert port.output.replace(" ", " ") == """\
                           
                           
    |    _  |_    | | |  _|
                           
                           
 _   _   _   _   _   _   _ 
    |    _  |_    | | |  _|
                           
                           
|   |   |   |   |   |   |  
    |    _  |_    | | |  _|
                           
                           
|_  |_  |_  |_  |_  |_  |_ 
    |    _  |_    | | |  _|
"""
